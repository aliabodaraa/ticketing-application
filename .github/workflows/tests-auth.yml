name: tests-auth

on:
  pull_request:
    paths:
      - "auth/**"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js 14.21.3
        uses: actions/setup-node@v3
        with:
          node-version: "14.21.3"

      - name: Print directory tree
        run: |
          echo "ğŸ“ Current directory:"
          pwd
          echo "ğŸ“ Directory structure:"
          find . -type f | sed 's/^/  - /'

      - name: Check for auth folder and package.json
        run: |
          if [ ! -d "./auth" ]; then
            echo "âŒ ERROR: auth folder not found."
            exit 1
          fi

          if [ ! -f "./auth/package.json" ]; then
            echo "âŒ ERROR: auth/package.json not found."
            ls -la ./auth
            exit 1
          fi

          echo "âœ… Found auth folder and package.json."

      - name: Install dependencies and run tests
        run: |
          cd auth
          echo "ğŸ“¦ Installing dependencies..."
          npm install

          echo "ğŸ§ª Running tests..."
          npm run test:ci
